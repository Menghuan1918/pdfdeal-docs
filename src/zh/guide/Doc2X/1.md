---
title: 处理图片
icon: images
---

## `Client.pic2file`

将一个或多个图片文件处理为指定格式的输出文件。

### 参数

| 参数名 | 类型 | 是否必须 | 默认值 | 描述 |
|--------|------|----------|--------|------|
| `image_file` | `str` 或 `list` | 是 | - | 单个图片文件路径或图片文件路径列表 |
| `output_path` | `str` | 否 | `"./Output"` | 输出文件夹路径 |
| `output_names` | `list` | 否 | `None` | 输出文件名列表，长度必须与`image_file`相同 |
| `output_format` | `str` | 否 | `"md_dollar"` | 输出格式，可选值：`"texts"`, `"md"`, `"md_dollar"`, `"latex"` |
| `img_correction` | `bool` | 否 | `True` | 是否进行图片矫正 |
| `equation` | `bool` | 否 | `False` | 是否使用纯公式输出模式 |
| `convert` | `bool` | 否 | `False` | 是否将`[`转换为`$`，`[[`转换为`$$`（仅当`output_format`为`"texts"`时有效） |

### 返回值

返回一个包含三个元素的元组 `(success_list, fail_list, has_failed)`：

1. `success_list` (list): 成功处理的文件列表
   - 元素为处理后的文件路径（字符串）
   - 处理失败时为空字符串

2. `fail_list` (list): 处理失败的文件列表
   - 元素为字典，包含两个键：
     - `'error'`: 错误信息（字符串）
     - `'path'`: 处理失败的文件路径（字符串）
   - 处理成功时，两个键的值均为空字符串

3. `has_failed` (bool): 处理状态
   - `True`: 至少有一个文件处理失败
   - `False`: 全部文件处理成功

### 注意事项

- `success_list` 和 `fail_list` 的长度相同
- 当 `output_format` 为 `"texts"` 时，直接返回文本，不会保存到文件

## 示例

> [!tip]
> 以下示例中`sample_bad.png`是一个**损坏**的图片，因此处理失败是**正常**的。

> [!important]
> 请确保你已经参照[初始化一节](Init.md)在环境变量中配置好密匙了

### 按照rpm限制处理多个图片

```python{1-2}
from pdfdeal import Doc2X
client = Doc2X()
file_list = ["tests/image/sample_bad.png", "tests/image/sample.png"]
success, failed, flag = client.pic2file(
    image_file=file_list,
    output_path="./Output/test/multiple/pdf2file",
    output_names=["sample1.docx", "sample2.docx"],
    output_format="docx",
)
print(success)
print(failed)
print(flag)

```

当第一个文件处理失败，第二个文件处理成功时，其示例输出，其中深色部分为打印出的`success`，`failed`，`flag`的值：

```zsh{11-13}
Get exception Upload file error! 400:{"code":"invalid request","msg":"img locked"}. Retrying in 1 seconds.
Waiting for processing: 0%    -- uuid: 8c438409-b409-444b-b6df-b89a00d77445
Get exception Upload file error! 400:{"code":"invalid request","msg":"img locked"}. Retrying in 2 seconds.
Success: 100%    -- uuid: 8c438409-b409-444b-b6df-b89a00d77445
Get exception Upload file error! 400:{"code":"invalid request","msg":"img locked"}. Retrying in 4 seconds.
IMG Progress: 1/2 files successfully processed.
-----
Failed deal with tests/image/sample_bad.png with error:
Error Upload file error! 400:{"code":"invalid request","msg":"img locked"}
-----
['', './Output/test/multiple/pdf2file/sample2.docx']
[{'error': 'Error Upload file error! 400:{"code":"invalid request","msg":"img locked"}', 'path': 'tests/image/sample_bad.png'}, {'error': '', 'path': ''}]
True
```

### 处理单个图片，在纯公式模式下，获得公式格式为`$公式$`形式的内容

```python
from pdfdeal.doc2x import Doc2X
client = Doc2X()
text,_,_ = client.pic2file(
    "tests/image/sample.png", output_format="texts", equation=True, convert=True
)
print(text)
```

示例输出：
```python
[['$$\\text{Test}$$']]
```